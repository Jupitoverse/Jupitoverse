<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Impact Simulator</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Exo:wght@600;700&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --bg-color: #121212;
            --primary-text: #e0e0e0;
            --secondary-text: #b3b3b3;
            --panel-bg: #1e1e1e;
            --border-color: #333333;
            --accent-color: #03dac6;
            --accent-hover: #01ab9b;
            --danger-color: #cf6679;
            --font-main: 'Roboto', sans-serif;
            --font-header: 'Exo', sans-serif;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--primary-text);
        }

        #app-container {
            display: flex;
            height: 100vh;
        }

        #map {
            height: 100%;
            flex-grow: 1;
            background-color: #000;
            cursor: crosshair;
        }

        #control-panel {
            width: 420px;
            background-color: var(--panel-bg);
            padding: 25px;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .control-panel-header h1 {
            font-family: var(--font-header);
            margin: 0 0 5px 0;
            font-weight: 700;
            color: var(--accent-color);
            letter-spacing: 1px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .control-group .value-display {
            float: right;
            font-weight: 700;
            color: var(--accent-color);
        }

        input[type=range] {
            width: 100%;
            -webkit-appearance: none;
            background: transparent;
            margin: 5px 0;
        }

        input[type=range]::-webkit-slider-runnable-track {
            height: 5px;
            cursor: pointer;
            background: var(--border-color);
            border-radius: 5px;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            margin-top: -7.5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            transition: background 0.2s ease;
        }

        input[type=range]:hover::-webkit-slider-thumb {
            background: var(--accent-hover);
        }

        select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--bg-color);
            color: var(--primary-text);
            font-size: 1em;
        }

        .action-button {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            font-weight: 700;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #launch-button {
            background-color: var(--accent-color);
            color: #111;
            margin-top: auto;
        }

        #launch-button:hover:not(:disabled) {
            background-color: var(--accent-hover);
            box-shadow: 0 0 12px var(--accent-color);
        }

        #launch-button:disabled {
            background-color: #555;
            color: #888;
            cursor: not-allowed;
        }

        #results-panel {
            padding: 10px 0;
            height: calc(100% - 20px);
            overflow-y: auto;
        }

        .results-header h2 {
            font-family: var(--font-header);
            margin: 0;
            color: var(--accent-color);
            text-align: center;
        }

        /* --- Enhanced Results & Interactivity --- */
        .result-card {
            background-color: #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 5px solid var(--border-color);
            transition: border-color 0.3s;
        }

        .result-card h3 {
            margin: 0 0 12px 0;
            font-size: 1.2em;
            font-family: var(--font-header);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .result-card li {
            padding: 9px 5px;
            color: var(--secondary-text);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .result-card li:hover {
            background-color: #383838;
        }

        .result-card li .value {
            font-weight: 700;
            color: var(--primary-text);
            text-align: right;
        }

        /* --- Visualization Overlay --- */
        #visual-overlay {
            position: relative;
            height: 100px;
            background: #2a2a2a;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
            padding: 10px;
            box-sizing: border-box;
        }

        #crater-profile {
            position: relative;
            width: 100%;
            height: 100%;
        }

        #crater-shape {
            position: absolute;
            bottom: 0;
            left: 50%;
            border: 2px solid var(--accent-color);
            border-top: none;
            background: #333;
        }

        .crater-label {
            position: absolute;
            color: var(--primary-text);
            font-size: 0.8em;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 4px;
            border-radius: 3px;
        }

        /* --- Animations --- */
        @keyframes explosion-flash {
            0% {
                transform: scale(0);
                opacity: 1
            }

            80% {
                transform: scale(20);
                opacity: 0.8
            }

            100% {
                transform: scale(25);
                opacity: 0
            }
        }

        .explosion {
            position: absolute;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 2000;
            animation: explosion-flash 0.7s ease-out forwards;
        }

        @keyframes shake {

            10%,
            90% {
                transform: translate3d(-1px, 0, 0)
            }

            20%,
            80% {
                transform: translate3d(2px, 0, 0)
            }

            30%,
            50%,
            70% {
                transform: translate3d(-4px, 0, 0)
            }

            40%,
            60% {
                transform: translate3d(4px, 0, 0)
            }
        }

        .map-shake {
            animation: shake 0.82s cubic-bezier(.36, .07, .19, .97) both;
        }

        /* --- Sources Section --- */
        .sources-section {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .sources-section h4 {
            margin: 0 0 10px 0;
            color: var(--secondary-text);
        }

        .sources-section a {
            color: var(--accent-color);
            text-decoration: none;
            font-size: 0.8em;
            display: block;
            margin-bottom: 5px;
            opacity: 0.7;
        }

        .sources-section a:hover {
            opacity: 1;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }

        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <div id="app-container">
        <div id="control-panel"></div>
        <div id="map"></div>
    </div>

    <template id="controls-template">
        <div class="control-panel-header">
            <h1>IMPACT SIMULATOR <sup>V3</sup></h1>
        </div>
        <div class="control-group">
            <label>Diameter <span class="value-display" id="diameter-value">500 ft</span></label>
            <input type="range" id="diameter-slider" min="50" max="5000" value="500" step="10">
        </div>
        <div class="control-group">
            <label>Speed <span class="value-display" id="speed-value">45,000 mph</span></label>
            <input type="range" id="speed-slider" min="25000" max="160000" value="45000" step="1000">
        </div>
        <div class="control-group">
            <label>Impact Angle <span class="value-display" id="angle-value">45¬∞</span></label>
            <input type="range" id="angle-slider" min="5" max="90" value="45" step="1">
        </div>
        <div class="control-group">
            <label for="material-select">Asteroid Material</label>
            <select id="material-select">
                <option value="stone">Stony Asteroid (Chondrite)</option>
                <option value="iron">Iron Asteroid</option>
                <option value="comet">Comet (Ice)</option>
            </select>
        </div>
        <button id="launch-button" class="action-button" disabled>SELECT A TARGET</button>
    </template>

    <template id="results-template">
        <div id="results-panel">
            <div class="results-header">
                <h2>IMPACT ANALYSIS</h2>
            </div>
            <div id="visual-overlay">
                <div id="crater-profile">
                    <div id="crater-shape"></div>
                    <div id="crater-depth-label" class="crater-label"></div>
                    <div id="crater-width-label" class="crater-label"></div>
                </div>
            </div>
            <button id="reset-button" class="action-button"
                style="background-color: var(--danger-color); color: #111; margin-top: 15px;">NEW SIMULATION</button>
            <div class="sources-section">
                <h4>Sources & Models</h4>
                <a href="https://impact.ese.ic.ac.uk/ImpactEarth/ImpactEffects/effects.pdf" target="_blank">Collins,
                    Melosh, & Marcus (2005) - Impact: Earth!</a>
                <a href="https://www.researchgate.net/publication/313857682" target="_blank">Rumpf et al. (2017) -
                    Population Vulnerability Models</a>
            </div>
        </div>
    </template>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONSTANTS & STATE ---
            const M_PER_MILE = 1609.34, M_PER_FT = 0.3048, G = 9.8;
            const DENSITIES = { iron: 8000, stone: 3300, comet: 1000 };
            let impactLocation = null, targetMarker = null;
            let activeVisualLayer = null;

            // --- UI & MAP REFERENCES ---
            const controlPanel = document.getElementById('control-panel');
            const mapElement = document.getElementById('map');
            const map = L.map('map', { center: [20, 0], zoom: 2 });
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>', maxZoom: 19
            }).addTo(map);

            // --- EVENT HANDLERS ---
            map.on('click', (e) => {
                impactLocation = e.latlng;
                if (targetMarker) map.removeLayer(targetMarker);
                targetMarker = L.marker(impactLocation, { icon: L.divIcon({ html: '<div style="font-size:24px;">üéØ</div>', className: '', iconSize: [24, 24], iconAnchor: [12, 12] }) }).addTo(map);
                document.getElementById('launch-button').disabled = false;
                document.getElementById('launch-button').textContent = 'LAUNCH ASTEROID';
            });

            function initializeControls() {
                controlPanel.innerHTML = '';
                controlPanel.appendChild(document.getElementById('controls-template').content.cloneNode(true));
                // Bind listeners for sliders and button
                ['diameter', 'speed', 'angle'].forEach(id => {
                    const slider = document.getElementById(`${id}-slider`);
                    slider.addEventListener('input', () => {
                        const display = document.getElementById(`${id}-value`);
                        const unit = id === 'angle' ? '¬∞' : (id === 'diameter' ? ' ft' : ' mph');
                        display.textContent = `${Number(slider.value).toLocaleString()}${unit}`;
                    });
                });
                document.getElementById('launch-button').addEventListener('click', runSimulation);
            }

            // --- SIMULATION & PHYSICS ---
            function runSimulation() {
                const diameter = document.getElementById('diameter-slider').value * M_PER_FT;
                const speed = (document.getElementById('speed-slider').value * M_PER_MILE) / 3600;
                const angleRad = document.getElementById('angle-slider').value * (Math.PI / 180);
                const projDensity = DENSITIES[document.getElementById('material-select').value];
                const targetDensity = 2700; // Average crustal rock

                const mass = projDensity * (4 / 3) * Math.PI * Math.pow(diameter / 2, 3);
                const initialKE = 0.5 * mass * Math.pow(speed, 2);

                // Atmospheric Entry Calculation
                const L_over_D = 1; // Lift/Drag ratio
                const C_D = 1; // Drag coefficient
                const H = 8000; // Scale height of atmosphere (m)
                const Y = 3e6; // Strength of asteroid (Pascals)

                const v_inf = speed;
                const z_burst = H * Math.log((L_over_D * projDensity * Math.pow(diameter, 1 / 3) * Math.pow(v_inf * Math.sin(angleRad), 2 / 3)) / Y);

                let finalKE = initialKE;
                let impactType = 'ground';
                if (z_burst > 0) { // Asteroid fragments/bursts in atmosphere
                    const v_final_sq = Math.pow(v_inf, 2) * Math.exp(- (C_D * 1.225 * Math.PI * Math.pow(diameter / 2, 2) * H) / (mass * Math.sin(angleRad)));
                    finalKE = 0.5 * mass * v_final_sq;
                    impactType = 'airburst';
                    // Check if it disintegrates completely
                    if (finalKE < initialKE * 0.01) {
                        impactType = 'disintegrated';
                        finalKE = 0;
                    }
                }

                const energyMegatons = finalKE / 4.184e15;

                const results = (finalKE > 0) ? {
                    impactType, energyMegatons,
                    crater: calculateCrater(finalKE, angleRad, projDensity, targetDensity),
                    fireball: calculateFireball(finalKE),
                    shockwave: calculateShockwave(energyMegatons),
                    ejecta: calculateEjecta(finalKE, angleRad, diameter),
                    seismic: calculateSeismic(finalKE)
                } : { impactType, energyMegatons: 0 };

                playExplosionAnimation(impactType, z_burst, energyMegatons);
                setTimeout(() => {
                    displayResults(results);
                    map.flyTo(impactLocation, Math.max(4, 9 - Math.log2(results.crater?.diameter || 100)));
                }, 500);
            }

            // --- CORE CALCULATIONS based on Collins, Melosh, Marcus (2005) ---
            function calculateCrater(E, angle, p_den, t_den) {
                if (E === 0) return { diameter: 0, depth: 0 };
                const D_transient = 1.161 * Math.pow(p_den / t_den, 1 / 3) * Math.pow(E, 0.28) * Math.pow(G, -0.22) * Math.pow(Math.sin(angle), 1 / 3);
                const D_final = (D_transient < 3200) ? D_transient : 1.17 * Math.pow(D_transient, 1.13) * Math.pow(3200, -0.13);
                const d_final = D_final / ((D_transient < 3200) ? 4 : 8); // Simplified depth
                return { diameter: D_final / M_PER_MILE, depth: d_final / M_PER_FT };
            }
            function calculateFireball(E) {
                const radius = 0.03 * Math.pow(E, 1 / 3); // in meters
                const duration = 0.003 * Math.pow(E, 1 / 3);
                // Thermal radiation for 3rd degree burns (Q > 10 cal/cm^2)
                const thermal_dist_m = Math.sqrt(E / (4 * Math.PI * 1e7 * 2.3e-10)); // Simplified
                return { diameter: (radius * 2) / M_PER_MILE, duration, thermalRadius: thermal_dist_m / M_PER_MILE };
            }
            function calculateShockwave(energyMT) {
                const radii = {};
                const pressures = { d5psi: 5, d1psi: 1 }; // PSI
                for (const [key, psi] of Object.entries(pressures)) {
                    // Using scaled distance from empirical fits
                    const scaled_dist = Math.pow((psi * 6894.76) / 101325, -0.55) * 2.9;
                    radii[key] = (scaled_dist * Math.pow(energyMT * 4.184e12, 1 / 3)) / M_PER_MILE;
                }
                return radii;
            }
            function calculateEjecta(E, angle, diameter) {
                const craterRadius = calculateCrater(E, angle, 8000, 2700).diameter / 2 * M_PER_MILE;
                const thickness_10_miles = (0.14 * Math.pow(craterRadius, 3.6)) / Math.pow(10, 3);
                const arrival_time = 0.8 * Math.sqrt(10 * M_PER_MILE / (G * Math.sin(angle)));
                return { thickness: thickness_10_miles * 3.281, arrival_minutes: arrival_time / 60 };
            }
            function calculateSeismic(E) {
                const M_w = (2 / 3) * (Math.log10(E * 1e-4) - 9.1);
                const getMercalli = (m) => {
                    if (m < 2) return "I: Not felt"; if (m < 3) return "II-III: Weak";
                    if (m < 4) return "IV: Light"; if (m < 5) return "V: Moderate";
                    if (m < 6) return "VI: Strong"; if (m < 7) return "VII: Very Strong";
                    if (m < 8) return "VIII: Severe"; if (m < 9) return "IX: Violent"; return "X+: Extreme";
                };
                return { magnitude: M_w, mercalli: getMercalli(M_w) };
            }

            // --- DISPLAY & VISUALIZATION ---
            function playExplosionAnimation(type, altitude, energyMT) {
                let loc = impactLocation;
                if (type === 'airburst') { // Shift explosion center up a bit to simulate altitude
                    const p = map.project(loc);
                    p.y -= Math.log2(energyMT + 1) * 20; // Visual altitude effect
                    loc = map.unproject(p);
                }
                const explosion = L.DomUtil.create('div', 'explosion', map.getPane('overlayPane'));
                const point = map.latLngToLayerPoint(loc);
                L.DomUtil.setPosition(explosion, point);
                setTimeout(() => explosion.remove(), 700);
            }

            function displayResults(r) {
                controlPanel.innerHTML = '';
                controlPanel.appendChild(document.getElementById('results-template').content.cloneNode(true));
                const resultsPanel = document.getElementById('results-panel');
                let resultsHTML;
                if (r.impactType === 'disintegrated') {
                    resultsHTML = `<div class="result-card"><h3>üå† Meteor Burn Up</h3><ul><li>The asteroid completely disintegrated in the upper atmosphere. No ground impact occurred. A bright meteor shower would be visible.</li></ul></div>`;
                } else {
                    resultsHTML = `
                <div class="result-card"><h3>üí• Summary</h3><ul>
                    <li data-visual="energy"><span>Energy Released</span><span class="value">${r.energyMegatons.toLocaleString(undefined, { maximumFractionDigits: 2 })} MT TNT</span></li>
                    <li data-visual="type"><span>Impact Type</span><span class="value">${r.impactType === 'airburst' ? 'Atmospheric Airburst' : 'Ground Impact'}</span></li>
                </ul></div>
                <div class="result-card"><h3>üï≥Ô∏è Crater</h3><ul>
                    <li data-visual="crater_diameter" data-value="${r.crater.diameter}"><span>Final Diameter</span><span class="value">${r.crater.diameter.toFixed(2)} miles</span></li>
                    <li data-visual="crater_depth" data-width="${r.crater.diameter}" data-depth="${r.crater.depth}"><span>Final Depth</span><span class="value">${r.crater.depth.toLocaleString(undefined, { maximumFractionDigits: 0 })} ft</span></li>
                </ul></div>
                <div class="result-card"><h3>üî• Fireball</h3><ul>
                    <li data-visual="fireball" data-value="${r.fireball.diameter}"><span>Max Fireball Diameter</span><span class="value">${r.fireball.diameter.toFixed(2)} miles</span></li>
                    <li data-visual="thermal" data-value="${r.fireball.thermalRadius}"><span>3rd-Degree Burn Radius</span><span class="value">${r.fireball.thermalRadius.toFixed(2)} miles</span></li>
                </ul></div>
                <div class="result-card"><h3>üí® Shockwave</h3><ul>
                    <li data-visual="shock_collapse" data-value="${r.shockwave.d5psi}"><span>Building Collapse Radius (5 psi)</span><span class="value">${r.shockwave.d5psi.toFixed(2)} miles</span></li>
                    <li data-visual="shock_ear" data-value="${r.shockwave.d1psi}"><span>Eardrum Rupture Radius (1 psi)</span><span class="value">${r.shockwave.d1psi.toFixed(2)} miles</span></li>
                </ul></div>
                 <div class="result-card"><h3>ü™® Ejecta</h3><ul>
                    <li data-visual="ejecta" data-value="${r.crater.diameter / 2}"><span>Ejecta Blanket Radius</span><span class="value">~${(r.crater.diameter / 2).toFixed(1)} miles</span></li>
                    <li data-visual="ejecta_arrival"><span>Arrival time at 10 miles</span><span class="value">~${r.ejecta.arrival_minutes.toFixed(1)} min</span></li>
                </ul></div>
                <div class="result-card"><h3>üåç Seismic Shock</h3><ul>
                    <li data-visual="earthquake"><span>Richter Magnitude</span><span class="value">${r.seismic.magnitude.toFixed(1)}</span></li>
                    <li data-visual="earthquake"><span>Mercalli Intensity at Epicenter</span><span class="value">${r.seismic.mercalli}</span></li>
                </ul></div>
                `;
                }
                const resetButton = resultsPanel.querySelector('#reset-button');
                resultsPanel.insertBefore(document.createRange().createContextualFragment(resultsHTML), resetButton);
                document.getElementById('reset-button').addEventListener('click', resetSimulation);
                addResultInteractivity();
            }

            function addResultInteractivity() {
                document.querySelectorAll('.result-card li').forEach(li => {
                    li.addEventListener('mouseover', (e) => handleVisual(e.currentTarget, 'show'));
                    li.addEventListener('mouseout', (e) => handleVisual(e.currentTarget, 'hide'));
                });
            }

            function handleVisual(element, action) {
                const visualType = element.dataset.visual;
                if (action === 'hide') {
                    if (activeVisualLayer) map.removeLayer(activeVisualLayer);
                    activeVisualLayer = null;
                    mapElement.classList.remove('map-shake');
                    document.getElementById('visual-overlay').style.display = 'none';
                    return;
                }

                // Clear previous visual before showing new one
                if (activeVisualLayer) map.removeLayer(activeVisualLayer);
                mapElement.classList.remove('map-shake');
                document.getElementById('visual-overlay').style.display = 'none';

                let radiusMiles = parseFloat(element.dataset.value);
                switch (visualType) {
                    case 'crater_diameter':
                    case 'fireball':
                    case 'thermal':
                    case 'shock_collapse':
                    case 'shock_ear':
                        activeVisualLayer = L.circle(impactLocation, {
                            radius: radiusMiles * M_PER_MILE,
                            color: visualType.includes('shock') ? '#66bfff' : (visualType.includes('fire') ? '#ff6b6b' : '#b58352'),
                            fillOpacity: 0.3, weight: 2
                        }).addTo(map);
                        break;
                    case 'ejecta':
                        activeVisualLayer = L.circle(impactLocation, {
                            radius: radiusMiles * M_PER_MILE, color: '#999999',
                            fillOpacity: 0.25, weight: 1, dashArray: '5, 5'
                        }).addTo(map);
                        break;
                    case 'crater_depth':
                        const vOverlay = document.getElementById('visual-overlay');
                        const profile = document.getElementById('crater-shape');
                        const depthLabel = document.getElementById('crater-depth-label');
                        const widthLabel = document.getElementById('crater-width-label');

                        vOverlay.style.display = 'block';
                        const w = parseFloat(element.dataset.width);
                        const d = parseFloat(element.dataset.depth) / 5280; // depth in miles
                        const ratio = Math.min(1, w / d / 5); // Exaggerate depth for visual clarity
                        profile.style.width = '90%';
                        profile.style.height = `${Math.min(90, (d / w) * 90 * 5)}%`;
                        profile.style.transform = 'translateX(-50%)';
                        profile.style.borderRadius = '50% 50% 0 0';
                        depthLabel.textContent = `${element.dataset.depth.toLocaleString(undefined, { maximumFractionDigits: 0 })} ft deep`;
                        widthLabel.textContent = `${w.toFixed(1)} mi wide`;
                        depthLabel.style.cssText = `bottom: 5px; left: 5px;`;
                        widthLabel.style.cssText = `top: 5px; right: 5px;`;
                        break;
                    case 'earthquake':
                        mapElement.classList.add('map-shake');
                        break;
                }
            }

            function resetSimulation() {
                if (activeVisualLayer) map.removeLayer(activeVisualLayer);
                if (targetMarker) map.removeLayer(targetMarker);
                mapElement.classList.remove('map-shake');
                targetMarker = null; impactLocation = null; activeVisualLayer = null;
                map.flyTo([20, 0], 2);
                initializeControls();
            }

            // --- INITIALIZE APP ---
            initializeControls();
        });
    </script>
</body>

</html>
